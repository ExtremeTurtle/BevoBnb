@{
    ViewData["Title"] = "Report";
}

<h1 class="mb-4">Reservation Report</h1>

<!-- Date Range Filter Form -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">Filter by Date Range</h3>
    </div>
    <div class="card-body">
        <form method="get" asp-action="Report">
            <div class="row">
                <div class="col-md-6">
                    <label for="startDate">Start Date:</label>
                    <input type="date" name="startDate" class="form-control" value="@ViewBag.StartDate" />
                </div>
                <div class="col-md-6">
                    <label for="endDate">End Date:</label>
                    <input type="date" name="endDate" class="form-control" value="@ViewBag.EndDate" />
                </div>
            </div>
            <div class="mt-3">
                <button type="submit" class="btn btn-primary">Filter</button>
            </div>
        </form>
    </div>
</div>

@if (User.IsInRole("Host"))
{
    if (ViewBag.HostReport == null)
    {
        <div class="alert alert-warning" role="alert">
            @ViewBag.Message
        </div>
    }
    else
    {
        <!-- Host-Specific Report -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title">Host Report</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Property ID</th>
                                <th>Total Stay Revenue (90%)</th>
                                <th>Total Cleaning Fees</th>
                                <th>Combined Revenue</th>
                                <th>Completed Reservations</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var report in (IEnumerable<dynamic>)ViewBag.HostReport)
                            {
                                <tr>
                                    <td>@report.PropertyName</td>
                                    <td>@report.TotalStayRevenue.ToString("C")</td>
                                    <td>@report.TotalCleaningFees.ToString("C")</td>
                                    <td>@report.CombinedRevenue.ToString("C")</td>
                                    <td>@report.CompletedReservations</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
}

@if (User.IsInRole("Admin"))
{
    <!-- Admin-Specific Report -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">Admin Report</h3>
        </div>
        <div class="card-body">
            <p><strong>Total Commission:</strong> @ViewBag.TotalCommission.ToString("C")</p>
            <p><strong>Total Reservations:</strong> @ViewBag.TotalReservations</p>
            <p><strong>Average Commission per Reservation:</strong> @ViewBag.AverageCommission.ToString("C")</p>
            <p><strong>Total Properties:</strong> @ViewBag.TotalProperties</p>
        </div>
    </div>
}

<!-- Reservations Table -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Reservations</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Check-In</th>
                        <th>Check-Out</th>
                        <th>Guests</th>
                        <th>Weekday Total</th>
                        <th>Weekend Total</th>
                        <th>Discount</th>
                        <th>Stay Price</th>
                        <th>Cleaning Fee</th>
                        <th>Subtotal</th>
                        <th>Tax</th>
                        <th>Total Price</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var reservation in (IEnumerable<Group7FinalProject.Models.Reservation>)ViewBag.AllReservations)
                    {
                        <tr>
                            <td class="text-truncate" style="max-width: 150px;">@reservation.Property.Address</td>
                            <td>@reservation.CheckIn.ToShortDateString()</td>
                            <td>@reservation.CheckOut.ToShortDateString()</td>
                            <td>@reservation.NumOfGuests</td>
                            <td>@reservation.WeekdayTotal.ToString("C")</td>
                            <td>@reservation.WeekendTotal.ToString("C")</td>
                            <td>@reservation.DiscountAmount.ToString("C")</td>
                            <td>@reservation.StayPrice.ToString("C")</td>
                            <td>@reservation.CleaningFee.ToString("C")</td>
                            <td>@reservation.SubTotal.ToString("C")</td>
                            <td>@reservation.Tax.ToString("C")</td>
                            <td>@reservation.TotalPrice.ToString("C")</td>
                            <td>@reservation.ReservationStatus</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
